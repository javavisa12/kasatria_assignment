<!DOCTYPE html>
<html>
<head>
    <title>Kasatria - 3D Directory Submission</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        /* General Setup */
        body { margin: 0; background-color: #000; overflow: hidden; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }
        
        /* [Image A] Refined Login Screen */
        #login-screen { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            background: #ffffff; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 9999; /* Ensure it stays on top of everything */
            text-align: center; 
        }
        #login-screen h1 { 
            font-size: 28px; 
            color: #202124; 
            margin-bottom: 8px; 
            font-weight: 500;
        }
        #login-screen p { 
            font-size: 14px; 
            color: #5f6368; 
            margin-bottom: 32px; 
            max-width: 350px; 
            line-height: 1.5;
            padding: 0 20px;
        }

        /* [Image B] Data Tile Structure */
        .element { width: 140px; height: 180px; box-shadow: 0px 0px 12px rgba(0,255,255,0.4); border: 1px solid rgba(127,255,255,0.2); text-align: center; }
        .element img { width: 90px; height: 90px; margin-top: 12px; border: 1px solid #fff; object-fit: cover; border-radius: 2px; }
        .element .name { font-size: 11px; font-weight: bold; color: #fff; margin-top: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .element .details { font-size: 9px; color: rgba(255,255,255,0.8); margin-top: 4px; }

        /* UI Navigation Menu */
        #menu { position: absolute; bottom: 30px; width: 100%; text-align: center; display: none; z-index: 2000; }
        button { 
            color: #00ffff; 
            background: rgba(0,0,0,0.3); 
            border: 1px solid #00ffff; 
            padding: 10px 20px; 
            cursor: pointer; 
            text-transform: uppercase; 
            margin: 0 8px; 
            font-size: 12px;
            font-weight: bold;
            transition: 0.3s;
        }
        button:hover { background: rgba(0,255,255,0.2); box-shadow: 0 0 10px #00ffff; }

        /* [Image B] Legend Bar */
        #legend { 
            position: absolute; 
            bottom: 90px; 
            right: 30px; 
            display: none; 
            align-items: center; 
            color: #fff; 
            font-size: 11px; 
            z-index: 2000; 
            background: rgba(0,0,0,0.7); 
            padding: 12px; 
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .gradient-bar { 
            width: 120px; 
            height: 10px; 
            background: linear-gradient(to right, #ef3022, #ffa500, #3a8448); 
            margin: 0 10px; 
            border: 1px solid #fff; 
        }
    </style>

    <script>
        // Global handler for Google Sign-In
        window.handleCredentialResponse = (response) => {
            document.getElementById('login-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('menu').style.display = 'block';
                document.getElementById('legend').style.display = 'flex';
            }, 500);
            window.dispatchEvent(new CustomEvent('start-3d-scene'));
        };
    </script>
</head>
<body>

    <div id="login-screen">
        <h1>Welcome Back</h1>
        <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.</p>
        <div id="g_id_onload"
             data-client_id="890084102471-1m4m60221cn3l6vfspk05t2338ln5jmr.apps.googleusercontent.com"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="filled_blue" data-text="signin_with" data-size="large" data-logo_alignment="left"></div>
    </div>

    <div id="container"></div>

    <div id="legend">
        <span>LOW</span>
        <div class="gradient-bar"></div>
        <span>High</span>
    </div>

    <div id="menu">
        <button id="table">TABLE</button>
        <button id="sphere">SPHERE</button>
        <button id="helix">HELIX</button>
        <button id="grid">GRID</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import TWEEN from 'three/addons/libs/tween.module.js';
        import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
        import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';

        const SPREADSHEET_ID = '1egK0W82Oltho21pc79BA0QcUdQv31f5wYEtiC-wN_Sk';
        const API_KEY = 'AIzaSyAFxfQzAIViNF0-opLFq1CHmhMzkb4CPt4'; 

        let camera, scene, renderer, controls;
        const objects = [];
        const targets = { table: [], sphere: [], helix: [], grid: [] };

        window.addEventListener('start-3d-scene', fetchSheetData);

        async function fetchSheetData() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Sheet1!A2:F?key=${API_KEY}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.values) {
                    init(data.values);
                    animate();
                }
            } catch (err) { console.error("Sheets Fetch Error:", err); }
        }

        function init(data) {
            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = 3000;
            scene = new THREE.Scene();

            data.forEach((row, i) => {
                const [name, photo, age, country, interest, netWorth] = row;
                const nw = parseFloat(netWorth.replace(/[$,]/g, ''));

                const element = document.createElement('div');
                element.className = 'element';
                
                // instruction coloring logic
                if (nw < 100000) element.style.backgroundColor = 'rgba(239, 48, 34, 0.75)'; 
                else if (nw < 200000) element.style.backgroundColor = 'rgba(255, 165, 0, 0.75)'; 
                else element.style.backgroundColor = 'rgba(58, 132, 72, 0.75)'; 

                const img = document.createElement('img');
                img.src = photo;
                element.appendChild(img);

                const nameDiv = document.createElement('div');
                nameDiv.className = 'name';
                nameDiv.textContent = name;
                element.appendChild(nameDiv);

                const details = document.createElement('div');
                details.className = 'details';
                details.innerHTML = `${interest}<br>${country}`;
                element.appendChild(details);

                const objectCSS = new CSS3DObject(element);
                objectCSS.position.x = Math.random() * 4000 - 2000;
                objectCSS.position.y = Math.random() * 4000 - 2000;
                objectCSS.position.z = Math.random() * 4000 - 2000;
                scene.add(objectCSS);
                objects.push(objectCSS);

                // Target: Table (20x10)
                const tableObj = new THREE.Object3D();
                tableObj.position.x = ((i % 20) * 170) - 1600; 
                tableObj.position.y = -(Math.floor(i / 20) * 210) + 900;
                targets.table.push(tableObj);
            });

            // Target: Sphere
            const vector = new THREE.Vector3();
            for (let i = 0, l = objects.length; i < l; i++) {
                const phi = Math.acos(-1 + (2 * i) / l);
                const theta = Math.sqrt(l * Math.PI) * phi;
                const object = new THREE.Object3D();
                object.position.setFromSphericalCoords(800, phi, theta);
                vector.copy(object.position).multiplyScalar(2);
                object.lookAt(vector);
                targets.sphere.push(object);
            }

            // Target: Double Helix
            for (let i = 0, l = objects.length; i < l; i++) {
                const strand = (i % 2 === 0) ? 0 : Math.PI; 
                const theta = i * 0.175 + strand;
                const y = -(i * 8) + 450;
                const object = new THREE.Object3D();
                object.position.setFromCylindricalCoords(900, theta, y);
                vector.x = object.position.x * 2;
                vector.y = object.position.y;
                vector.z = object.position.z * 2;
                object.lookAt(vector);
                targets.helix.push(object);
            }

            // Target: Grid (5x4x10)
            for (let i = 0; i < objects.length; i++) {
                const object = new THREE.Object3D();
                object.position.x = ((i % 5) * 400) - 800;
                object.position.y = (-(Math.floor(i / 5) % 4) * 400) + 600;
                object.position.z = (Math.floor(i / 20)) * -1000 + 500;
                targets.grid.push(object);
            }

            renderer = new CSS3DRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('container').appendChild(renderer.domElement);

            controls = new TrackballControls(camera, renderer.domElement);
            controls.addEventListener('change', render);

            document.getElementById('table').addEventListener('click', () => transform(targets.table, 2000));
            document.getElementById('sphere').addEventListener('click', () => transform(targets.sphere, 2000));
            document.getElementById('helix').addEventListener('click', () => transform(targets.helix, 2000));
            document.getElementById('grid').addEventListener('click', () => transform(targets.grid, 2000));

            transform(targets.table, 2000);
            window.addEventListener('resize', onWindowResize);
        }

        function transform(targetArr, duration) {
            TWEEN.removeAll();
            objects.forEach((obj, i) => {
                const target = targetArr[i];
                if (target) {
                    new TWEEN.Tween(obj.position).to({ x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration).easing(TWEEN.Easing.Exponential.InOut).start();
                    new TWEEN.Tween(obj.rotation).to({ x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration).easing(TWEEN.Easing.Exponential.InOut).start();
                }
            });
            new TWEEN.Tween(this).to({}, duration * 2).onUpdate(render).start();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            render();
        }

        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update();
            controls.update();
        }

        function render() { renderer.render(scene, camera); }
    </script>
</body>
</html>
